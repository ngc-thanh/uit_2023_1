-- Nguyen Chi thanh - 23210067 --
-- PHAN 1 --
--- 1.	Tạo các quan hệ và khai báo các khóa chính, khóa ngoại của quan hệ ---
-- TAO BANG KHACHHANG --
-- TAO BANG KHACHHANG --
CREATE TABLE KHACHHANG
(
	MAKH char(4) NOT NULL PRIMARY KEY,
	HOTEN varchar(40),
	DCHI varchar(50),
	SODT varchar(20),
	NGSINH smalldatetime,
	DOANHSO money,
	NGDK smalldatetime
)

-- TAO BANG NHANVIEN --
CREATE TABLE NHANVIEN
(
	MANV char(4) NOT NULL PRIMARY KEY,
	HOTEN varchar(40),
	SODT varchar(20),
	NGVL smalldatetime
)

-- TAO BANG SANPHAM --
CREATE TABLE SANPHAM
(
	MASP char(4) NOT NULL PRIMARY KEY,
	TENSP varchar(40),
	DVT varchar(20),
	NUOCSX varchar(40),
	GIA money
)

-- TAO BANG HOADON --
CREATE TABLE HOADON
(
	SOHD int NOT NULL PRIMARY KEY,
	NGHD smalldatetime,
	MAKH char(4) NOT NULL FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
	MANV char(4) NOT NULL FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	TRIGIA money
)

-- TAO BANG CHITIETHOADON --
CREATE TABLE CTHD
(
	SOHD int,
	MASP char(4) NOT NULL FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP),
	SL int,
)

-- 2.	Thêm vào thuộc tính GHICHU có kiểu dữ liệu varchar(20) cho quan hệ SANPHAM.--
ALTER TABLE SANPHAM
ADD GHICHU varchar(20);

-- 3.	Thêm vào thuộc tính LOAIKH có kiểu dữ liệu là tinyint cho quan hệ KHACHHANG.--
ALTER TABLE KHACHHANG
ADD LOAIKH tinyint;

-- 4.	Sửa kiểu dữ liệu của thuộc tính GHICHU trong quan hệ SANPHAM thành varchar(100).--
ALTER TABLE SANPHAM
ALTER COLUMN GHICHU varchar(100);

-- 5.	Xóa thuộc tính GHICHU trong quan hệ SANPHAM. --
ALTER TABLE SANPHAM
DROP COLUMN GHICHU;

-- PHAN II --
-- 1.	Nhập dữ liệu cho các quan hệ trên. ---
-- KHACHHANG --
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH01','Nguyen Van A','731 Tran Hung Dao, Q5, TpHCM','8823451','1960-10-22','13,060,000','2006-07-22');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH02','Tran Ngoc Han','23/5 Nguyen Trai, Q5, TpHCM','908256478','1974-04-03','280','2006-07-30');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH03','Tran Ngoc Linh','45 Nguyen Canh Chan, Q1, TpHCM','938776266','1980-06-12','3,860,000','2006-08-05');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH04','Tran Minh Long','50/34 Le Dai Hanh, Q10, TpHCM','917325476','1965-03-09','250','2006-10-02');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH05','Le Nhat Minh','34 Truong Dinh, Q3, TpHCM','8246108','1950-03-10','21','2006-10-28');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH06','Le Hoai Thuong','227 Nguyen Van Cu, Q5, TpHCM','8631738','1981-12-31','915','2006-11-24');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH07','Nguyen Van Tam','32/3 Tran Binh Trong, Q5, TpHCM','916783565','1971-04-06','12,5','2006-12-01');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH08','Phan Thi Thanh','45/2 An Duong Vuong, Q5, TpHCM','938435756','1971-01-10','365','2006-12-13');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH09','Le Ha Vinh','873 Le Hong Phong, Q5, TpHCM','8654763','1979-09-03','70','2007-01-14');
INSERT INTO KHACHHANG (MAKH,HOTEN,DCHI,SODT,NGSINH,DOANHSO,NGDK) VALUES('KH10','Ha Duy Lap','34/34B Nguyen Trai, Q1, TpHCM','8768904','1983-05-02','67,5','2007-01-16');

-- NHANVIEN --
INSERT INTO NHANVIEN (MANV,HOTEN,DTHOAI,NGVL) VALUES('NV01','Nguyen Nhu Nhut','927345678','2006-04-13');
INSERT INTO NHANVIEN (MANV,HOTEN,DTHOAI,NGVL) VALUES('NV02','Le Thi Phi Yen','987567390','2006-04-21');
INSERT INTO NHANVIEN (MANV,HOTEN,DTHOAI,NGVL) VALUES('NV03','Nguyen Van B','997047382','2006-04-27');
INSERT INTO NHANVIEN (MANV,HOTEN,DTHOAI,NGVL) VALUES('NV04','Ngo Thanh Tuan','913758498','2006-06-24');
INSERT INTO NHANVIEN (MANV,HOTEN,DTHOAI,NGVL) VALUES('NV05','Nguyen Thi Truc Thanh','918590387','2006-07-20');

-- SANPHAM --
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BC01','But chi','cay','Singapore','3');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BC02','But chi','cay','Singapore','5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BC03','But chi','cay','Viet Nam','3,5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BC04','But chi','hop','Viet Nam','30');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BB01','But bi','cay','Viet Nam','5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BB02','But bi','cay','Trung Quoc','7');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('BB03','But bi','hop','Thai Lan','100');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV01','Tap 100 giay mong','quyen','Trung Quoc','2,5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV02','Tap 200 giay mong','quyen','Trung Quoc','4,5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV03','Tap 100 giay tot','quyen','Viet Nam','3');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV04','Tap 200 giay tot','quyen','Viet Nam','5,5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV05','Tap 100 trang','chuc','Viet Nam','23');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV06','Tap 200 trang','chuc','Viet Nam','53');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('TV07','Tap 100 trang','chuc','Trung Quoc','34');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST01','So tay 500 trang','quyen','Trung Quoc','40');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST02','So tay loai 1','quyen','Viet Nam','55');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST03','So tay loai 2','quyen','Viet Nam','51');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST04','So tay','quyen','Thai Lan','55');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST05','So tay mong','quyen','Thai Lan','20');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST06','Phan viet bang','hop','Viet Nam','5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST07','Phan khong bui','hop','Viet Nam','7');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST08','Bong bang','cai','Viet Nam','1');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST09','But long','cay','Viet Nam','5');
INSERT INTO SANPHAM (MASP,TENSP,DVT,NUOCSX,GIA) VALUES('ST10','But long','cay','Trung Quoc','7');

-- HOADON --
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1001','2006-07-23','KH01','NV01','320');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1002','2006-08-12','KH01','NV02','840');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1003','2006-08-23','KH02','NV01','100');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1004','2006-09-01','KH02','NV01','180');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1005','2006-10-20','KH01','NV02','3,800,000');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1006','2006-10-16','KH01','NV03','2,430,000');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1007','2006-10-28','KH03','NV03','510');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1008','2006-10-28','KH01','NV03','440');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1009','2006-10-28','KH03','NV04','200');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1010','2006-11-01','KH01','NV01','5,200,000');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1011','2006-11-04','KH04','NV03','250');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1012','2006-11-30','KH05','NV03','21');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1013','2006-12-12','KH06','NV01','5');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1014','2006-12-31','KH03','NV02','3,150,000');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1015','2007-01-01','KH06','NV01','910');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1016','2007-01-01','KH07','NV02','12,5');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1017','2007-01-02','KH08','NV03','35');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1018','2007-01-13','KH08','NV03','330');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1019','2007-01-13','KH01','NV03','30');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1020','2007-01-14','KH09','NV04','70');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1021','2007-01-16','KH10','NV03','67,5');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1022','2007-01-16','Null','NV03','7');
INSERT INTO HOADON (SOHD,NGHD,MAKH,MANV,TRIGIA) VALUES('1023','2007-01-17','Null','NV01','330');

-- CTHD --
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1001','TV02','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1001','ST01','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1001','BC01','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1001','BC02','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1001','ST08','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1002','BC04','20');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1002','BB01','20');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1002','BB02','20');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1003','BB03','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1004','TV01','20');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1004','TV02','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1004','TV03','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1004','TV04','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1005','TV05','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1005','TV06','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1006','TV07','20');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1006','ST01','30');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1006','ST02','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1007','ST03','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1008','ST04','8');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1009','ST05','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1010','TV07','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1010','ST07','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1010','ST08','100');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1010','ST04','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1010','TV03','100');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1011','ST06','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1012','ST07','3');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1013','ST08','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1014','BC02','80');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1014','BB02','100');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1014','BC04','60');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1014','BB01','50');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1015','BB02','30');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1015','BB03','7');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1016','TV01','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1017','TV02','1');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1017','TV03','1');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1017','TV04','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1018','ST04','6');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1019','ST05','1');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1019','ST06','2');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1020','ST07','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1021','ST08','5');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1021','TV01','7');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1021','TV02','10');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1022','ST07','1');
INSERT INTO CTHD (SOHD,MASP,SL) VALUES('1023','ST04','6');

-- 2.	Tạo quan hệ SANPHAM1 chứa toàn bộ dữ liệu của quan hệ SANPHAM. Tạo quan hệ KHACHHANG1 chứa toàn bộ dữ liệu của quan hệ KHACHHANG. --
INSERT INTO SANPHAM1 SELECT * FROM SANPHAM;
INSERT INTO KHACHHANG1 SELECT * FROM KHACHHANG;

-- 3.	Cập nhật giá tăng 5% đối với những sản phẩm do “Thai Lan” sản xuất (cho quan hệ SANPHAM1) --
UPDATE SANPHAM1
SET GIA = GIA * 1.05
WHERE NUOCSX = 'Thai Lan';

-- 4.	Cập nhật giá giảm 5% đối với những sản phẩm do “Trung Quoc” sản xuất có giá từ 10.000 trở xuống (cho quan hệ SANPHAM1).
UPDATE SANPHAM1 
SET GIA = GIA * 0.95
WHERE NUOCSX = 'Trung Quoc' AND GIA >= 10000;

-- 5.	Cập nhật giá trị LOAIKH là “Vip” đối với những khách hàng đăng ký thành viên trước ngày 1/1/2007 có doanh số từ 10.000.000 trở lên hoặc khách hàng đăng ký thành viên từ 1/1/2007 trở về sau có doanh số từ 2.000.000 trở lên (cho quan hệ KHACHHANG1).
UPDATE KHACHHANG1
SET LOAIKH = 'Vip'
WHERE (NGDK < '2007-01-01' AND DOANHSO >= 10000000)
   OR (NGDK >= '2007-01-01' AND DOANHSO >= 2000000);

-- PHAN 3 --
-- 1.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất. --
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc';

-- 2.	In ra danh sách các sản phẩm (MASP, TENSP) có đơn vị tính là “cay”, ”quyen”. --
SELECT MASP, TENSP
FROM SANPHAM1
WHERE DONVITINH IN ('cay', 'quyen');

-- 3.	In ra danh sách các sản phẩm (MASP,TENSP) có mã sản phẩm bắt đầu là “B” và kết thúc là “01”. --
SELECT MASP, TENSP
FROM SANPHAM1
WHERE MASP LIKE 'B%01';

-- 4.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quốc” sản xuất có giá từ 30.000 đến 40.000. --
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc' AND GiaBan BETWEEN 30000 AND 40000;

-- 5.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” hoặc “Thai Lan” sản xuất có giá từ 30.000 đến 40.000. --
SELECT MASP, TENSP
FROM SANPHAM1
WHERE (NUOCSX = 'Trung Quoc' OR NUOCSX = 'Thai Lan') AND GiaBan BETWEEN 30000 AND 40000;

-- 6.	In ra các số hóa đơn, trị giá hóa đơn bán ra trong ngày 1/1/2007 và ngày 2/1/2007. --
SELECT SOHD, TONGTIEN
FROM HOADON
WHERE NGAYBAN BETWEEN '2007-01-01' AND '2007-01-02';

-- 7.	In ra các số hóa đơn, trị giá hóa đơn trong tháng 1/2007, sắp xếp theo ngày (tăng dần) và trị giá của hóa đơn (giảm dần). --
SELECT SOHD, TONGTIEN
FROM HOADON
WHERE NGAYBAN BETWEEN '2007-01-01' AND '2007-01-31'
ORDER BY NGAYBAN ASC, TONGTIEN DESC;

-- 8.	In ra danh sách các khách hàng (MAKH, HOTEN) đã mua hàng trong ngày 1/1/2007. -- 
SELECT DISTINCT KHACHHANG1.MAKH, KHACHHANG1.HOTEN
FROM KHACHHANG1
JOIN HOADON ON KHACHHANG1.MAKH = HOADON.MAKH
WHERE HOADON.NGAYBAN = '2007-01-01';

-- 9.	In ra số hóa đơn, trị giá các hóa đơn do nhân viên có tên “Nguyen Van B” lập trong ngày 28/10/2006. -- 
SELECT SOHD, TONGTIEN
FROM HOADON
WHERE NGAYLAP = '2006-10-28' AND MANV IN (
    SELECT MANV
    FROM NHANVIEN
    WHERE HOTEN = 'Nguyen Van B'
);

-- 10.	In ra danh sách các sản phẩm (MASP,TENSP) được khách hàng có tên “Nguyen Van A” mua trong tháng 10/2006. -- 
SELECT DISTINCT SANPHAM1.MASP, SANPHAM1.TENSP
FROM SANPHAM1
JOIN CTHD ON SANPHAM1.MASP = CTHD.MASP
JOIN HOADON ON CTHD.SOHD = HOADON.SOHD
JOIN KHACHHANG1 ON HOADON.MAKH = KHACHHANG1.MAKH
WHERE KHACHHANG1.HOTEN = 'Nguyen Van A' AND HOADON.NGAYBAN BETWEEN '2006-10-01' AND '2006-10-31';

-- 11.	Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”. -- 
SELECT DISTINCT HOADON.SOHD
FROM HOADON
JOIN CTHD ON HOADON.SOHD = CTHD.SOHD
WHERE CTHD.MASP IN ('BB01', 'BB02');

-- 12.	Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20. -- 
SELECT HOADON.SOHD
FROM HOADON
JOIN CTHD ON HOADON.SOHD = CTHD.SOHD
WHERE CTHD.MASP IN ('BB01', 'BB02')
  AND CTHD.SL BETWEEN 10 AND 20;

-- 13.	Tìm các số hóa đơn mua cùng lúc 2 sản phẩm có mã số “BB01” và “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20. --
SELECT HOADON.SOHD
FROM HOADON
JOIN CTHD CTHD1 ON HOADON.SOHD = CTHD1.SOHD
JOIN CTHD CTHD2 ON HOADON.SOHD = CTHD2.SOHD
WHERE CTHD1.MASP = 'BB01' AND CTHD1.SL BETWEEN 10 AND 20
  AND CTHD2.MASP = 'BB02' AND CTHD2.SL BETWEEN 10 AND 20;

-- 14.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất hoặc các sản phẩm được bán ra trong ngày 1/1/2007. -- 
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc'
   OR MASP IN (SELECT DISTINCT MASP FROM CTHD JOIN HOADON ON CTHD.SOHD = HOADON.SOHD WHERE NGAYBAN = '2007-01-01');

-- 15.	In ra danh sách các sản phẩm (MASP,TENSP) không bán được. -- 
SELECT MASP, TENSP
FROM SANPHAM1
WHERE MASP NOT IN (SELECT DISTINCT MASP FROM CTHD);

-- 16.	In ra danh sách các sản phẩm (MASP,TENSP) không bán được trong năm 2006.
SELECT MASP, TENSP
FROM SANPHAM1
WHERE MASP NOT IN (SELECT DISTINCT MASP FROM CTHD JOIN HOADON ON CTHD.SOHD = HOADON.SOHD WHERE YEAR(NGAYBAN) = 2006);

-- 17.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất không bán được trong năm 2006.
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc' AND MASP NOT IN (SELECT DISTINCT MASP FROM CTHD JOIN HOADON ON CTHD.SOHD = HOADON.SOHD WHERE YEAR(NGAYBAN) = 2006);

-- 18.	Tìm số hóa đơn đã mua tất cả các sản phẩm do Singapore sản xuất.
SELECT HOADON.SOHD
FROM HOADON
JOIN CTHD ON HOADON.SOHD = CTHD.SOHD
WHERE CTHD.MASP NOT IN (SELECT DISTINCT MASP FROM SANPHAM1 WHERE NUOCSX <> 'Singapore');

-- 19.	Tìm số hóa đơn trong năm 2006 đã mua ít nhất tất cả các sản phẩm do Singapore sản xuất.
SELECT HOADON.SOHD
FROM HOADON
JOIN CTHD ON HOADON.SOHD = CTHD.SOHD
WHERE YEAR(NGAYBAN) = 2006
GROUP BY HOADON.SOHD
HAVING COUNT(DISTINCT CTHD.MASP) = (SELECT COUNT(DISTINCT MASP) FROM SANPHAM1 WHERE NUOCSX = 'Singapore');

-- 20.	Có bao nhiêu hóa đơn không phải của khách hàng đăng ký thành viên mua?
SELECT COUNT(DISTINCT SOHD)
FROM HOADON
WHERE MAKH NOT IN (SELECT MAKH FROM KHACHHANG1 WHERE LOAIKH = 'Dang ky thanh vien');

-- 21.	Có bao nhiêu sản phẩm khác nhau được bán ra trong năm 2006.
SELECT COUNT(DISTINCT MASP)
FROM CTHD
JOIN HOADON ON CTHD.SOHD = HOADON.SOHD
WHERE YEAR(NGAYBAN) = 2006;

-- 22.	Cho biết trị giá hóa đơn cao nhất, thấp nhất là bao nhiêu ?
SELECT MAX(TONGTIEN) AS TrigiaCaoNhat, MIN(TONGTIEN) AS TrigiaThapNhat
FROM HOADON;

-- 23.	Trị giá trung bình của tất cả các hóa đơn được bán ra trong năm 2006 là bao nhiêu?
SELECT AVG(TONGTIEN) AS TrigiaTrungBinh
FROM HOADON
WHERE YEAR(NGAYBAN) = 2006;

-- 24.	Tính doanh thu bán hàng trong năm 2006.
SELECT SUM(TONGTIEN) AS DoanhThu
FROM HOADON
WHERE YEAR(NGAYBAN) = 2006;

-- 25.	Tìm số hóa đơn có trị giá cao nhất trong năm 2006.
SELECT SOHD, TONGTIEN
FROM HOADON
WHERE TONGTIEN = (SELECT MAX(TONGTIEN) FROM HOADON WHERE YEAR(NGAYBAN) = 2006);

-- 26.	Tìm họ tên khách hàng đã mua hóa đơn có trị giá cao nhất trong năm 2006.
SELECT KHACHHANG1.HOTEN
FROM KHACHHANG1
JOIN HOADON ON KHACHHANG1.MAKH = HOADON.MAKH
WHERE HOADON.TONGTIEN = (SELECT MAX(TONGTIEN) FROM HOADON WHERE YEAR(NGAYBAN) = 2006);

-- 27.	In ra danh sách 3 khách hàng đầu tiên (MAKH, HOTEN) sắp xếp theo doanh số giảm dần.
SELECT MAKH, HOTEN
FROM KHACHHANG1
ORDER BY (SELECT SUM(TONGTIEN) FROM HOADON WHERE HOADON.MAKH = KHACHHANG1.MAKH) DESC
LIMIT 3;

-- 28.	In ra danh sách các sản phẩm (MASP, TENSP) có giá bán bằng 1 trong 3 mức giá cao nhất.
SELECT MASP, TENSP
FROM SANPHAM1
WHERE GiaBan IN (SELECT DISTINCT GiaBan FROM SANPHAM1 ORDER BY GiaBan DESC LIMIT 3);

-- 29.	In ra danh sách các sản phẩm (MASP, TENSP) do “Thai Lan” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của tất cả các sản phẩm).
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Thai Lan' AND GiaBan IN (SELECT DISTINCT GiaBan FROM SANPHAM1 WHERE NUOCSX = 'Thai Lan' ORDER BY GiaBan DESC LIMIT 3);

-- 30.	In ra danh sách các sản phẩm (MASP, TENSP) do “Trung Quoc” sản xuất có giá bằng 1 trong 3 mức giá cao nhất (của sản phẩm do “Trung Quoc” sản xuất).
SELECT MASP, TENSP
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc' AND GiaBan IN (SELECT DISTINCT GiaBan FROM SANPHAM1 WHERE NUOCSX = 'Trung Quoc' ORDER BY GiaBan DESC LIMIT 3);

-- 31.	* In ra danh sách khách hàng nằm trong 3 hạng cao nhất (xếp hạng theo doanh số).
SELECT KHACHHANG1.MAKH, KHACHHANG1.HOTEN
FROM KHACHHANG1
JOIN HOADON ON KHACHHANG1.MAKH = HOADON.MAKH
GROUP BY KHACHHANG1.MAKH, KHACHHANG1.HOTEN
ORDER BY SUM(HOADON.TONGTIEN) DESC
LIMIT 3;

-- 32.	Tính tổng số sản phẩm do “Trung Quoc” sản xuất.
SELECT COUNT(MASP) AS TongSanPhamTrungQuoc
FROM SANPHAM1
WHERE NUOCSX = 'Trung Quoc';

-- 33.	Tính tổng số sản phẩm của từng nước sản xuất.
SELECT NUOCSX, COUNT(MASP) AS TongSanPham
FROM SANPHAM1
GROUP BY NUOCSX;

-- 34.	Với từng nước sản xuất, tìm giá bán cao nhất, thấp nhất, trung bình của các sản phẩm.
SELECT NUOCSX, MAX(GiaBan) AS GiaBanCaoNhat, MIN(GiaBan) AS GiaBanThapNhat, AVG(GiaBan) AS GiaBanTrungBinh
FROM SANPHAM1
GROUP BY NUOCSX;

-- 35.	Tính doanh thu bán hàng mỗi ngày.
SELECT NGAYBAN, SUM(TONGTIEN) AS DoanhThu
FROM HOADON
GROUP BY NGAYBAN;

-- 36.	Tính tổng số lượng của từng sản phẩm bán ra trong tháng 10/2006.
SELECT CTHD.MASP, SANPHAM1.TENSP, SUM(CTHD.SL) AS TongSoLuong
FROM CTHD
JOIN SANPHAM1 ON CTHD.MASP = SANPHAM1.MASP
JOIN HOADON ON CTHD.SOHD = HOADON.SOHD
WHERE YEAR(NGAYBAN) = 2006 AND MONTH(NGAYBAN) = 10
GROUP BY CTHD.MASP, SANPHAM1.TENSP;

-- 37.	Tính doanh thu bán hàng của từng tháng trong năm 2006.
SELECT MONTH(NGAYBAN) AS Thang, SUM(TONGTIEN) AS DoanhThu
FROM HOADON
WHERE YEAR(NGAYBAN) = 2006
GROUP BY MONTH(NGAYBAN);

-- 38.	Tìm hóa đơn có mua ít nhất 4 sản phẩm khác nhau.
SELECT SOHD
FROM CTHD
GROUP BY SOHD
HAVING COUNT(DISTINCT MASP) >= 4;

-- 39.	Tìm hóa đơn có mua 3 sản phẩm do “Viet Nam” sản xuất (3 sản phẩm khác nhau).
SELECT HOADON.SOHD
FROM HOADON
JOIN CTHD ON HOADON.SOHD = CTHD.SOHD
JOIN SANPHAM1 ON CTHD.MASP = SANPHAM1.MASP
WHERE NUOCSX = 'Viet Nam'
GROUP BY HOADON.SOHD
HAVING COUNT(DISTINCT CTHD.MASP) = 3;

-- 40.	Tìm khách hàng (MAKH, HOTEN) có số lần mua hàng nhiều nhất.
SELECT MAKH, HOTEN
FROM KHACHHANG1
WHERE MAKH IN (SELECT MAKH FROM HOADON GROUP BY MAKH ORDER BY COUNT(*) DESC LIMIT 1);

-- 41.	Tháng mấy trong năm 2006, doanh số bán hàng cao nhất ?
SELECT MONTH(NGAYBAN) AS Thang, SUM(TONGTIEN) AS DoanhSo
FROM HOADON
WHERE YEAR(NGAYBAN) = 2006
GROUP BY MONTH(NGAYBAN)
ORDER BY SUM(TONGTIEN) DESC
LIMIT 1;

-- 42.	Tìm sản phẩm (MASP, TENSP) có tổng số lượng bán ra thấp nhất trong năm 2006.
SELECT CTHD.MASP, SANPHAM1.TENSP, SUM(CTHD.SL) AS TongSoLuong
FROM CTHD
JOIN SANPHAM1 ON CTHD.MASP = SANPHAM1.MASP
JOIN HOADON ON CTHD.SOHD = HOADON.SOHD
WHERE YEAR(NGAYBAN) = 2006
GROUP BY CTHD.MASP, SANPHAM1.TENSP
ORDER BY TongSoLuong
LIMIT 1;

-- 43.	*Mỗi nước sản xuất, tìm sản phẩm (MASP,TENSP) có giá bán cao nhất.
SELECT NUOCSX, MASP, TENSP, GiaBan
FROM SANPHAM1
WHERE (NUOCSX, GiaBan) IN (SELECT NUOCSX, MAX(GiaBan) FROM SANPHAM1 GROUP BY NUOCSX);

-- 44.	Tìm nước sản xuất sản xuất ít nhất 3 sản phẩm có giá bán khác nhau.
SELECT NUOCSX
FROM SANPHAM1
GROUP BY NUOCSX
HAVING COUNT(DISTINCT GiaBan) >= 3;

-- 45.	*Trong 10 khách hàng có doanh số cao nhất, tìm khách hàng có số lần mua hàng nhiều nhất.
SELECT KHACHHANG1.MAKH, KHACHHANG1.HOTEN, COUNT(HOADON.MAKH) AS SoLanMua
FROM KHACHHANG1
JOIN HOADON ON KHACHHANG1.MAKH = HOADON.MAKH
WHERE KHACHHANG1.MAKH IN (SELECT MAKH FROM HOADON GROUP BY MAKH ORDER BY SUM(TONGTIEN) DESC LIMIT 10)
GROUP BY KHACHHANG1.MAKH, KHACHHANG1.HOTEN
ORDER BY SoLanMua DESC
LIMIT 1;

-- BAI TAP 2--
